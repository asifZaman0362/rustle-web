<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rustle</title>
    <style>
        html, body {
            padding: 0;
            margin: 0;
            background: rgb(28, 28, 28);
            color: white;
            height: 100%;
        }
        #topbar {
            text-align: center;
            background-color: #1d1d1d;
            border-bottom: 1px solid gray;
            margin-bottom: 100px;
        }
        #grid-container {
            display: flex;
            flex-direction: column;
            row-gap: 10px;
            align-items: center;
        }
        .row {
            display: flex;
            flex-direction: row;
            column-gap: 10px;
        }
        .letter {
            width: 60px;
            height: 60px;
            border: 2px solid gray;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .letter.correct {
            background-color: green;
        }
        .letter.wrong {
            background-color: lightslategray;
        }
        .letter.misplaced {
            background-color: rgb(168, 168, 87);
        }
        .letter span {
            font-weight: bold;
            font-family: sans-serif;
            font-size: 42px;
        }
        #toast {
            width: 100%;
            display: flex;
            justify-content: center;
            top: 80px;
            position: absolute;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        #toast span {
            display: block;
            text-align: center;
            background-color: white;
            border-radius: 15px;
            padding: 10px 20px;
            color: black;
            font-family: sans-serif;
        }
        .checked {
            animation: 0.5s linear flip;
            animation-delay: calc(var(--index) * 0.1s);
        }
        .shake {
            animation: 0.5s linear 0s shake;
        }
        #toast.visible {
            opacity: 1 !important;
        }
        @keyframes flip {
            0% {
                transform: scaleY(1);
            }
            50% {
                transform: scaleY(0);
            }
            100% {
                transform: scaleY(1);
            }
        }
        @keyframes shake {
            0% {
                translate: 0px;
            }
            10% {
                translate: 10px;
            }
            40% {
                translate: -10px;
            }
            50% {
                translate: 0px;
            }
            60% {
                translate: 10px;
            }
            90% {
                translate: -10px;
            }
            100% {
                translate: 0px;
            }
        }
        #statsparent {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #stats {
            width: 600px;
            padding: 40px;
            display: block;
            background-color: #282828;
            border: 1px solid gray;
            border-radius: 5px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #stats h3 {
            font-family: sans-serif;
            text-transform: uppercase;
        }
        #stats ul.overall {
            list-style: none;
            display: inline-flex;
            width: 400px;
        }
        #stats ul.overall li {
            display: inline-block;
            flex: 1;
        }
        #stats h2 {
            font-size: 42px;
            margin: 0;
        }
        #stats ul.overall li span {
            font-size: 12px;
            text-transform: capitalize;
        }
        #stats ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .button {
            background-color: olivedrab;
            color: white;
            width: 100px;
            padding: 10px 10px;
            margin: 20px 5px 0;
            font-family: sans-serif;
            text-transform: capitalize;
            display: inline-block;
            border-radius: 20px;
        }
        .close {
            background-color: rgb(201, 87, 87);
        }
        .bar input {
            height: 20px;
            border-radius: 5px;
            border: none;
            background: transparent;
            width: 100%;
        }

        .bar input::-moz-range-thumb {
            width: 0px;
            height: 0px;
            border-radius: 50%;
            background: #04AA6D;
            cursor: pointer;
            visibility: hidden;
        }

        .bar input::-moz-range-track {
            background-color: transparent;
            border-radius: 5px;
            border: none;
            height: 20px;
        }

        .bar input::-moz-range-progress {
            background-color: white;
            height: 20px;
            border-radius: 5px;
            border: none;
        }

    </style>
</head>
<body>
    <div id="toast">
        <span>Some error happened</span>
    </div>
    <div id="topbar">
        <h1 id="title">Rustle</h1>
    </div>
    <div id="grid-container">
        
    </div>
    <div id="statsparent">
        <div id="stats">
            <h3>statistics</h3>
            <ul class="overall">
                <li>
                    <h2>0</h2>
                    <span>played</span>
                </li>
                <li>
                    <h2>0</h2>
                    <span>win %</span>
                </li>
                <li>
                    <h2>0</h2>
                    <span>current streak</span>
                </li>
                <li>
                    <h2>0</h2>
                    <span>max streak</span>
                </li>
            </ul>
            <h3>guess distribution</h3>
            <ul>
                <li>
                    <div class="bar">
                        <label for="ones">1</label>
                        <input type="range" name="ones" id="ones">
                    </div>
                </li>
                <li>
                    <div class="bar">
                        <label for="twos">2</label>
                        <input type="range" name="twos" id="twos">
                    </div>
                </li>
                <li>
                    <div class="bar">
                        <label for="threes">3</label>
                        <input type="range" name="threes" id="threes">
                    </div>
                </li>
                <li>
                    <div class="bar">
                        <label for="fours">4</label>
                        <input type="range" name="fours" id="fours">
                    </div>
                </li>
                <li>
                    <div class="bar">
                        <label for="fives">5</label>
                        <input type="range" name="fives" id="fives">
                    </div>
                </li>
                <li>
                    <div class="bar">
                        <label for="sixes">6</label>
                        <input type="range" name="sixes" id="sixes">
                    </div>
                </li>
            </ul>
            <div class="button-bar">
                <div class="button" onclick="restart()">
                    <span>restart</span>
                </div>
                <div class="button close" onclick="closePanel()">
                    <span>close</span>
                </div>
            </div>
        </div>
    </div>
    <div id="keyboard"></div>
    <script>

        const ROWS = 6;
        const COLS = 5;
        let guess = "";
        let letters = [];
        let x = 0, y = 0;
        let toastTimer = null;
        let toastObject = null;
        const endMessages = [
            "Genius",
            "Excellent",
            "Great",
            "Good",
            "Passable",
            "Whew!"
        ];

        function generateDom(){
            toastObject = document.getElementById("toast");
            document.body.appendChild(toastObject);
            let grid_container = document.getElementById("grid-container");
            for (let i = 0; i < ROWS; i++) {
                let row = document.createElement("div");
                let this_row = [];
                row.className = "row";
                for (let j = 0; j < COLS; j++) {
                    let letter = document.createElement("div");
                    letter.className = "letter";
                    letter.style = "--index: " + j;
                    let inner = document.createElement("span");
                    this_row.push(inner);
                    letter.appendChild(inner);
                    row.appendChild(letter);
                }
                letters.push(this_row);
                grid_container.appendChild(row);
            }
        }
        
        function addLetter(char) {
            if (guess.length < 5) {
                guess += char;
                letters[y][x].innerHTML = char.toUpperCase();
                x++;
            }
        }
        
        function setLetters(_letters) {
            guess = "";
            for (let letter of _letters) {
                let i = letter.position;
                letters[y][i].parentElement.classList.add('checked');
                switch (letter.e_type) {
                    case "Misplaced": {
                        letters[y][i].parentElement.classList.add('misplaced')
                    }
                    case "Wrong": {
                        letters[y][i].parentElement.classList.add('wrong')
                    }
                    case "Correct": {
                        letters[y][i].parentElement.classList.add('correct')
                    }
                }
            }
            y++;
            x = 0;
        }
        
        function showToast(message) {
            if (toastTimer != null)
                clearTimeout(toastTimer);
            toastObject.className = "visible";
            toastObject.children[0].innerHTML = message;
            toastTimer = setTimeout(() => { toastObject.className = ""; }, 1000);
        }
        
        function processGuessResult(json) {
            console.log(json);
            if (json.Ok) {
                if (json.Ok.Guess) {
                    setLetters(json.Ok.Guess);
                } else if (json.Ok.MaxGuess) {
                    showToast("Maximum number of guesses reached!");
                } else if (json.Ok.Won) {
                    setLetters(json.Ok.Won[0]);
                    showToast(endMessages[json.Ok.Won[1]]);
                }
            } else if (json.Err) {
                showToast("Not in word list!");
            }
        }
        
        function submitWord() {
            if (guess.length == 5) {
                fetch("http://localhost:8000/submit/" + guess)
                .then((res) => {
                    return res.json();
                })
                .then((json) => processGuessResult(json))
                .catch((err) => console.error(err));
            }
        }
        
        function removeLetter() {
            if (guess.length == 0) return;
            guess = guess.substring(0, guess.length - 1);
            letters[y][--x].innerHTML = "";
        }

        function onKeyPress(event) {
            let regex = new RegExp("[a-zA-Z]");
            if (event.key.length == 1 && event.key.match(regex) != null) {
                addLetter(event.key);
            } else if (event.key == "Backspace") {
                removeLetter();
            } else if (event.key == "Enter") {
                submitWord();
            }
        }
        
        document.onkeydown = onKeyPress;

        generateDom();

    </script>
</body>
</html>